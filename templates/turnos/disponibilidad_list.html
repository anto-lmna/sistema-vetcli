{% extends 'base_dashboard.html' %}
{% load static %}
{% load django_bootstrap5 %}
{% block extra_css %}
        <link rel="stylesheet" href="{% static 'css/base.css' %}">
{% endblock %}
{% block title %}Mis Disponibilidades{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
        <h2 class="fw-bold mb-0"><i class="fa-solid fa-calendar-day"></i><span class='m-2'>Mis Disponibilidades</span></h2>
        <a href="{% url 'turnos:crear_disponibilidad' %}" class="btn btn-primary">
            <i class="fa-regular fa-square-plus"></i> Nueva Disponibilidad
        </a>
    </div>

    <!-- Barra de filtros -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body d-flex flex-wrap justify-content-between align-items-center gap-3">
            <div class="btn-group" role="group">
                <a href="?filtro=futuras" 
                   class="btn {% if filtro_actual == 'futuras' %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">
                   <i class="fa-solid fa-calendar"></i> Futuras
                </a>
                <a href="?filtro=pasadas" 
                   class="btn {% if filtro_actual == 'pasadas' %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">
                    <i class="fa-solid fa-clock-rotate-left"></i> Pasadas
                </a>
            </div>
            <form method="get" class="d-flex align-items-center gap-2">
                <input type="hidden" name="filtro" value="{{ filtro_actual }}">
                <input type="date" name="buscar_fecha" 
                       value="{{ request.GET.buscar_fecha|default:'' }}"
                       class="form-control form-control-sm" style="max-width: 160px;">
                <button type="submit" class="btn btn-outline-secondary btn-sm">Buscar</button>
            </form>
        </div>
    </div>

    {% if disponibilidades %}
    <div class="card shadow-sm">
        <div class="card-body p-0 m-3">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th><i class="fa-regular fa-calendar-days m-2"></i>Rango de Fechas</th>
                        <th><i class="fa-solid fa-clock m-2"></i> Horario</th>
                        <th><i class="fa-solid fa-spinner m-2"></i> Duración</th>
                        <th><i class="fa-regular fa-calendar-days"></i> Turnos generados</th>
                        <th><i class="fa-solid fa-calendar-check"></i> Reservados</th>
                        <th><i class="fa-solid fa-gear"></i> Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for disp in disponibilidades %}
                    <tr >
                        <td>
                            <span class="fw-semibold">{{ disp.fecha_inicio|date:"d/m/Y" }}</span> → 
                            <span class="fw-semibold">{{ disp.fecha_fin|date:"d/m/Y" }}</span>
                        </td>
                        <td>{{ disp.hora_inicio|time:"H:i" }} - {{ disp.hora_fin|time:"H:i" }}</td>
                        <td>{{ disp.duracion_turno }} min</td>

                        <td class="text-primary fw-semibold">{{ disp.turnos_generados.count }}</td>
                        <td class="{% if disp.turnos_reservados.count > 0 %}text-success{% else %}text-muted{% endif %}">
                            {{ disp.turnos_reservados.count }}
                        </td>

                        <td>
                            {% if disp.turnos_reservados.count == 0 %}
                                <a href="{% url 'turnos:eliminar_disponibilidad' disp.id %}"
                                   class="btn btn-outline-danger btn-sm">
                                   <i class="fa-solid fa-trash-can"></i> Eliminar
                                </a>
                            {% else %}
                                <span class="badge bg-secondary">Bloqueada</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <!-- Estado: sin resultados -->
    <div class="text-center text-muted py-5">
        <p class="fs-5 mb-2">
            {% if filtro_actual == 'pasadas' %}
                No hay disponibilidades pasadas.
            {% else %}
                No hay disponibilidades futuras registradas.
            {% endif %}
        </p>
        <a href="{% url 'turnos:crear_disponibilidad' %}" class="btn btn-outline-primary btn-sm">
            <i class="fa-solid fa-plus"></i> Crear una nueva disponibilidad
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
